#updates values
name: pipeline
on: [push]
jobs:
  update_values:
    runs-on: ubuntu-latest
    steps:
      - name: Clone the test repository
        run: |
          git clone https://github.com/Annaliskirwa/_Test.git
          echo "Cloned the repository"
      - name: Updating the image tags for master
        run: |
          ls -la
          echo "Switching folders"
          cd _Test
          ls -la
          git switch master
          echo "Switched branch to master"
      - name: Update image tag for values.yaml file
        run: |
          cd _Test
          echo "Trying to update image tags"
          pwd
          if [ -f values.yaml ];
          ls -la
            then sed -ri '1,/^(\s*)(tag*)/ s/^(\s*)(tag*:[[:blank:]]*).*/\1tag: "today"/'  values.yaml;
          fi
          echo "updated the image tag to today"
          cat values.yaml
      - name: Commit the changes and push to master
        run: |
          cd _Test
          pwd
          ls -la
          cat values.yaml
          git config --global user.name "Annaliskirwa"
          git config --global user.email "annaliskirwa@gmail.com"
          git config --global user.password "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"
          git add values.yaml
          git commit -am "updated the tag to today"
          echo "Committed successfully"
          git push origin master https://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@github.com/Annaliskirwa/_Test.git
          echo "Pushed successfully"
          

